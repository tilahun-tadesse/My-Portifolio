<template>
  <div class="tech-sphere">
    <div class="tech-sphere-container">
      <div ref="cloudRef" class="tagcloud-container">
        <!-- The sphere will be rendered here -->
      </div>
    </div>
  </div>
</template>

<script setup>
  import { onMounted, ref, onBeforeUnmount } from "vue";

  // Reference to the container
  const cloudRef = ref(null);
  let tagCloudInstance = null;

  // Tech stack with icons (using direct SVG paths)
  const techStack = [
    {
      name: "Vue",
      color: "#42b883",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="32" height="32">
              <path fill="#42b883" d="M78.8,10L64,35.4L49.2,10H0l64,110l64-110C128,10,78.8,10,78.8,10z"/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#0288d1" d="M21.81 10.25c-.06-.04-.56-.43-1.64-.43c-.28 0-.56.03-.84.08c-.21-1.4-1.38-2.11-1.43-2.14l-.29-.17l-.18.27c-.24.36-.43.77-.51 1.19c-.2.8-.08 1.56.33 2.21c-.49.28-1.29.35-1.46.35H2.62c-.34 0-.62.28-.62.63c0 1.15.18 2.3.58 3.38c.45 1.19 1.13 2.07 2 2.61c.98.6 2.59.94 4.42.94c.79 0 1.61-.07 2.42-.22c1.12-.2 2.2-.59 3.19-1.16A8.3 8.3 0 0 0 16.78 16c1.05-1.17 1.67-2.5 2.12-3.65h.19c1.14 0 1.85-.46 2.24-.85c.26-.24.45-.53.59-.87l.08-.24zm-17.96.99h1.76c.08 0 .16-.07.16-.16V9.5c0-.08-.07-.16-.16-.16H3.85c-.09 0-.16.07-.16.16v1.58c.01.09.07.16.16.16m2.43 0h1.76c.08 0 .16-.07.16-.16V9.5c0-.08-.07-.16-.16-.16H6.28c-.09 0-.16.07-.16.16v1.58c.01.09.07.16.16.16m2.47 0h1.75c.1 0 .17-.07.17-.16V9.5c0-.08-.06-.16-.17-.16H8.75c-.08 0-.15.07-.15.16v1.58c0 .09.06.16.15.16m2.44 0h1.77c.08 0 .15-.07.15-.16V9.5c0-.08-.06-.16-.15-.16h-1.77c-.08 0-.15.07-.15.16v1.58c0 .09.07.16.15.16M6.28 9h1.76c.08 0 .16-.09.16-.18V7.25c0-.09-.07-.16-.16-.16H6.28c-.09 0-.16.06-.16.16v1.57c.01.09.07.18.16.18m2.47 0h1.75c.1 0 .17-.09.17-.18V7.25c0-.09-.06-.16-.17-.16H8.75c-.08 0-.15.06-.15.16v1.57c0 .09.06.18.15.18m2.44 0h1.77c.08 0 .15-.09.15-.18V7.25c0-.09-.07-.16-.15-.16h-1.77c-.08 0-.15.06-.15.16v1.57c0 .09.07.18.15.18m0-2.28h1.77c.08 0 .15-.07.15-.16V5c0-.1-.07-.17-.15-.17h-1.77c-.08 0-.15.06-.15.17v1.56c0 .08.07.16.15.16m2.46 4.52h1.76c.09 0 .16-.07.16-.16V9.5c0-.08-.07-.16-.16-.16h-1.76c-.08 0-.15.07-.15.16v1.58c0 .09.07.16.15.16"/></svg>
              <path fill="#35495e" d="M78.8,10L64,35.4L49.2,10H25.6L64,76l38.4-66H78.8z"/>
            </svg>`,
    },
    {
      name: "Nuxt",
      color: "#00DC82",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="#00e676" d="m30.27 23l-6.93-12a1.98 1.98 0 0 0-1.73-1a1.96 1.96 0 0 0-1.73 1l-2.27 3.93l-3.88-6.71a1.996 1.996 0 0 0-3.46 0L1.73 23a2 2 0 0 0 1.73 3h8.915a6 6 0 0 0 5.197-3.001L21.61 16l3.46 6h-2.31l-2.31 4h8.09a2 2 0 0 0 1.73-3m-17.896-1H6.93L12 13.22l3.3 5.71l-1.193 2.069A2 2 0 0 1 12.374 22"/></svg>`,
    },
    {
      name: "Docker",
      color: "#2496ED",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="#0288d1" d="M21.81 10.25c-.06-.04-.56-.43-1.64-.43c-.28 0-.56.03-.84.08c-.21-1.4-1.38-2.11-1.43-2.14l-.29-.17l-.18.27c-.24.36-.43.77-.51 1.19c-.2.8-.08 1.56.33 2.21c-.49.28-1.29.35-1.46.35H2.62c-.34 0-.62.28-.62.63c0 1.15.18 2.3.58 3.38c.45 1.19 1.13 2.07 2 2.61c.98.6 2.59.94 4.42.94c.79 0 1.61-.07 2.42-.22c1.12-.2 2.2-.59 3.19-1.16A8.3 8.3 0 0 0 16.78 16c1.05-1.17 1.67-2.5 2.12-3.65h.19c1.14 0 1.85-.46 2.24-.85c.26-.24.45-.53.59-.87l.08-.24zm-17.96.99h1.76c.08 0 .16-.07.16-.16V9.5c0-.08-.07-.16-.16-.16H3.85c-.09 0-.16.07-.16.16v1.58c.01.09.07.16.16.16m2.43 0h1.76c.08 0 .16-.07.16-.16V9.5c0-.08-.07-.16-.16-.16H6.28c-.09 0-.16.07-.16.16v1.58c.01.09.07.16.16.16m2.47 0h1.75c.1 0 .17-.07.17-.16V9.5c0-.08-.06-.16-.17-.16H8.75c-.08 0-.15.07-.15.16v1.58c0 .09.06.16.15.16m2.44 0h1.77c.08 0 .15-.07.15-.16V9.5c0-.08-.06-.16-.15-.16h-1.77c-.08 0-.15.07-.15.16v1.58c0 .09.07.16.15.16M6.28 9h1.76c.08 0 .16-.09.16-.18V7.25c0-.09-.07-.16-.16-.16H6.28c-.09 0-.16.06-.16.16v1.57c.01.09.07.18.16.18m2.47 0h1.75c.1 0 .17-.09.17-.18V7.25c0-.09-.06-.16-.17-.16H8.75c-.08 0-.15.06-.15.16v1.57c0 .09.06.18.15.18m2.44 0h1.77c.08 0 .15-.09.15-.18V7.25c0-.09-.07-.16-.15-.16h-1.77c-.08 0-.15.06-.15.16v1.57c0 .09.07.18.15.18m0-2.28h1.77c.08 0 .15-.07.15-.16V5c0-.1-.07-.17-.15-.17h-1.77c-.08 0-.15.06-.15.17v1.56c0 .08.07.16.15.16m2.46 4.52h1.76c.09 0 .16-.07.16-.16V9.5c0-.08-.07-.16-.16-.16h-1.76c-.08 0-.15.07-.15.16v1.58c0 .09.07.16.15.16"/></svg>`,
    },
    {
      name: "Node.js",
      color: "#339933",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="32" height="32">
              <path fill="#339933" d="M112.678 30.334L68.535 4.729c-2.781-1.584-6.424-1.584-9.227 0L14.82 30.334C11.971 31.985 10 35.088 10 38.407v51.142c0 3.319 1.992 6.423 4.862 8.083l11.729 6.688c5.627 2.772 7.186 2.772 9.746 2.772 8.334 0 12.662-5.039 12.662-13.828v-50.49C49 42.061 49.445 41 48.744 41h-5.622C42.41 41 41 42.061 41 42.773v50.49c0 3.896-3.616 7.773-10.202 4.48L18.676 90.73c-.422-.23-.676-.693-.676-1.181V38.407c0-.482.463-.966.891-1.213l44.378-25.561a1.508 1.508 0 0 1 1.507 0l43.837 25.555c.421.253.675.718.675 1.219v51.142c0 .488-.054.963-.481 1.209l-44.051 25.551c-.432.252-.904.252-1.353 0L51.02 83.282c-.36-.208-.773-.275-1.142-.129-3.377 1.358-3.861 1.621-6.926 3.075-.493.292-.66.773-.394 1.241l22.742 13.38c2.809 1.627 6.346 1.567 9.103.054l43.755-25.354c2.783-1.595 4.842-4.739 4.842-8.088V38.407c0-3.319-1.967-6.442-4.862-8.073z"/>
            </svg>`,
    },
    {
      name: "TypeScript",
      color: "#3178C6",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="32" height="32">
              <path fill="#3178C6" d="M2,63.91v62.5h125V1.41H2Zm100.73-5a15.56,15.56,0,0,1,7.82,4.5,20.58,20.58,0,0,1,3,4c0,.16-5.4,3.81-8.69,5.85-.12.08-.6-.44-1.13-1.23a7.09,7.09,0,0,0-5.87-3.53c-3.79-.26-6.23,1.73-6.21,5a4.58,4.58,0,0,0,.54,2.34c.83,1.73,2.38,2.76,7.24,4.86,8.95,3.85,12.78,6.39,15.16,10,2.66,4,3.25,10.46,1.45,15.24-2,5.2-6.9,8.73-13.83,9.9a38.32,38.32,0,0,1-9.52-.1A23,23,0,0,1,80,109.19c-1.15-1.27-3.39-4.58-3.25-4.82a9.34,9.34,0,0,1,1.15-.73L82.5,101l3.59-2.08.75,1.11a16.78,16.78,0,0,0,4.74,4.54c4,2.1,9.46,1.81,12.16-.62a5.43,5.43,0,0,0,.69-6.92c-1-1.39-3-2.56-8.59-5-6.45-2.78-9.23-4.5-11.77-7.24a16.48,16.48,0,0,1-3.43-6.25,25,25,0,0,1-.22-8c1.33-6.23,6-10.58,12.82-11.87A31.66,31.66,0,0,1,102.73,58.93ZM73.39,64.15l0,5.12H57.16V115.5H45.65V69.26H29.38v-5a49.19,49.19,0,0,1,.14-5.16c.06-.08,10-.12,22-.1L73.33,59Z"/>
            </svg>`,
    },
    {
      name: "Tailwind",
      color: "#06B6D4",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="32" height="32">
              <path fill="#06B6D4" d="M64 25.62c-17.2 0-27.94 8.68-32.24 26.04 6.45-8.6 14-11.95 22.64-10.05 4.92 1.08 8.43 4.24 12.34 7.72 6.34 5.64 13.67 12.17 29.59 12.17 17.19 0 27.94-8.68 32.24-26.04-6.45 8.6-14 11.95-22.64 10.05-4.92-1.08-8.43-4.24-12.33-7.72-6.35-5.64-13.69-12.17-29.6-12.17Zm-32.24 39.06c-17.2 0-27.94 8.68-32.24 26.04 6.45-8.6 14-11.95 22.64-10.05 4.92 1.08 8.43 4.24 12.34 7.72 6.34 5.64 13.67 12.17 29.59 12.17 17.19 0 27.94-8.68 32.24-26.04-6.45 8.6-14 11.95-22.64 10.05-4.92-1.08-8.43-4.24-12.33-7.72-6.35-5.64-13.69-12.17-29.6-12.17Z"/>
            </svg>`,
    },
    {
      name: "Go",
      color: "#47A248",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="#00acc1" d="M2 12h4v2H2zm-2 4h6v2H0zm4 4h2v2H4zm16.954-5H14v3h3.239a4.42 4.42 0 0 1-3.531 2a2.65 2.65 0 0 1-2.053-.858a2.86 2.86 0 0 1-.628-2.28A4.515 4.515 0 0 1 15.292 13a2.73 2.73 0 0 1 1.749.584l2.962-1.185A5.6 5.6 0 0 0 15.292 10a7.526 7.526 0 0 0-7.243 6.5a5.614 5.614 0 0 0 5.659 6.5a7.526 7.526 0 0 0 7.243-6.5a6.4 6.4 0 0 0 .003-1.5"/><path fill="#00acc1" d="M26.292 10a7.526 7.526 0 0 0-7.243 6.5a5.614 5.614 0 0 0 5.659 6.5a7.526 7.526 0 0 0 7.243-6.5a5.614 5.614 0 0 0-5.659-6.5m2.681 6.137A4.515 4.515 0 0 1 24.708 20a2.65 2.65 0 0 1-2.053-.858a2.86 2.86 0 0 1-.628-2.28A4.515 4.515 0 0 1 26.292 13a2.65 2.65 0 0 1 2.053.858a2.86 2.86 0 0 1 .628 2.28Z"/></svg>`,
    },
    {
      name: "Git",
      color: "#F05032",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="32" height="32">
              <path fill="#F05032" d="M124.737 58.378L69.621 3.264c-3.172-3.174-8.32-3.174-11.497 0L46.68 14.71l14.518 14.518c3.375-1.139 7.243-.375 9.932 2.314 2.703 2.706 3.461 6.607 2.294 9.993l13.992 13.993c3.385-1.167 7.292-.413 9.994 2.295 3.78 3.777 3.78 9.9 0 13.679a9.673 9.673 0 01-13.683 0 9.677 9.677 0 01-2.105-10.521L68.574 47.933l-.002 34.341a9.708 9.708 0 012.559 1.828c3.778 3.777 3.778 9.898 0 13.683-3.779 3.777-9.904 3.777-13.679 0-3.778-3.784-3.778-9.905 0-13.683a9.65 9.65 0 013.167-2.11V47.333a9.581 9.581 0 01-3.167-2.111c-2.862-2.86-3.551-7.06-2.083-10.576L41.056 20.333 3.264 58.123a8.133 8.133 0 000 11.5l55.117 55.114c3.174 3.174 8.32 3.174 11.499 0l54.858-54.858a8.135 8.135 0 00-.001-11.501z"/>
            </svg>`,
    },
    {
      name: "JavaScript",
      color: "#F7DF1E",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="32" height="32">
              <path fill="#F7DF1E" d="M1.408 1.408h125.184v125.185H1.408z"/>
              <path fill="#323330" d="M116.347 96.736c-.917-5.711-4.641-10.508-15.672-14.981-3.832-1.761-8.104-3.022-9.377-5.926-.452-1.69-.512-2.642-.226-3.665.821-3.32 4.784-4.355 7.925-3.403 2.023.678 3.938 2.237 5.093 4.724 5.402-3.498 5.391-3.475 9.163-5.879-1.381-2.141-2.118-3.129-3.022-4.045-3.249-3.629-7.676-5.498-14.756-5.355l-3.688.477c-3.534.893-6.902 2.748-8.877 5.235-5.926 6.724-4.236 18.492 2.975 23.335 7.104 5.332 17.54 6.545 18.873 11.531 1.297 6.104-4.486 8.08-10.234 7.378-4.236-.881-6.592-3.034-9.139-6.949-4.688 2.713-4.688 2.713-9.508 5.485 1.143 2.499 2.344 3.63 4.26 5.795 9.068 9.198 31.76 8.746 35.83-5.176.165-.478 1.261-3.666.38-8.581zM69.462 58.943H57.753l-.048 30.272c0 6.438.333 12.34-.714 14.149-1.713 3.558-6.152 3.117-8.175 2.427-2.059-1.012-3.106-2.451-4.319-4.485-.333-.584-.583-1.036-.667-1.071l-9.52 5.83c1.583 3.249 3.915 6.069 6.902 7.901 4.462 2.678 10.459 3.499 16.731 2.059 4.082-1.189 7.604-3.652 9.448-7.401 2.666-4.915 2.094-10.864 2.07-17.444.06-10.735.001-21.468.001-32.237z"/>
            </svg>`,
    },
    {
      name: "HTML5",
      color: "#E34F26",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="32" height="32">
              <path fill="#E44D26" d="M19.037 113.876L9.032 1.661h109.936l-10.016 112.198-45.019 12.48z"/>
              <path fill="#F16529" d="M64 116.8l36.378-10.086 8.559-95.878H64z"/>
              <path fill="#EBEBEB" d="M64 52.455H45.788L44.53 38.361H64V24.599H29.489l.33 3.692 3.382 37.927H64zm0 35.743l-.061.017-15.327-4.14-.979-10.975H33.816l1.928 21.609 28.193 7.826.063-.017z"/>
              <path fill="#fff" d="M63.952 52.455v13.763h16.947l-1.597 17.849-15.35 4.143v14.319l28.215-7.82.207-2.325 3.234-36.233.335-3.696h-3.708zm0-27.856v13.762h33.244l.276-3.092.628-6.978.329-3.692z"/>
            </svg>`,
    },
    {
      name: "CSS3",
      color: "#1572B6",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="32" height="32">
              <path fill="#1572B6" d="M18.814 114.123L8.76 1.352h110.48l-10.064 112.754-45.243 12.543-45.119-12.526z"/>
              <path fill="#33A9DC" d="M64.001 117.062l36.559-10.136 8.601-96.354h-45.16v106.49z"/>
              <path fill="#fff" d="M64.001 51.429h18.302l1.264-14.163H64.001V23.435h34.682l-.332 3.711-3.4 38.114h-30.95V51.429z"/>
              <path fill="#EBEBEB" d="M64.083 87.349l-.061.018-15.403-4.159-.985-11.031H33.752l1.937 21.717 28.331 7.863.063-.018v-14.39z"/>
              <path fill="#fff" d="M81.127 64.675l-1.666 18.522-15.426 4.164v14.39l28.354-7.858.208-2.337 2.406-26.881H81.127z"/>
              <path fill="#EBEBEB" d="M64.048 23.435v13.831H30.64l-.277-3.108-.63-7.012-.331-3.711h34.646zm-.047 27.996v13.831H48.792l-.277-3.108-.631-7.012-.33-3.711h16.447z"/>
            </svg>`,
    },
    {
      name: "Vite",
      color: "#646CFF",
      svg: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="32" height="32">
              <path fill="#646CFF" d="M63.984 15.82L16.939 93.131h19.684l10.573-17.778L78.037 93.13h19.684L64.044 15.82h-.06zm0 22.742l16.525 27.93H47.46l16.525-27.93z"/>
            </svg>`,
    },
  ];

  onMounted(async () => {
    if (!cloudRef.value) return;

    try {
      // Dynamically import TagCloud
      const TagCloud = await import("TagCloud").then(
        (module) => module.default || module
      );

      // Instead of using tech names, we'll create placeholder elements
      // that we'll replace with icons
      const placeholders = techStack.map((_, index) => `item-${index}`);

      // Initialize TagCloud
      const radius = 300;
      const options = {
        radius: radius,
        maxSpeed: "normal",
        initSpeed: "normal",
        direction: 135,
        keep: true,
      };

      // Create the sphere
      tagCloudInstance = TagCloud(cloudRef.value, placeholders, options);

      // After TagCloud initialization, replace placeholders with icons
      const items = document.querySelectorAll(".tagcloud--item");

      // For each item in the cloud
      items.forEach((item, index) => {
        const tech = techStack[index % techStack.length];

        // Clear the text content (placeholder)
        item.textContent = "";

        // Create a wrapper for the icon
        const iconWrapper = document.createElement("div");
        iconWrapper.className = "tech-icon";
        iconWrapper.style.color = tech.color;

        // Insert the SVG directly
        iconWrapper.innerHTML = tech.svg;

        // Append icon to the tag item
        item.appendChild(iconWrapper);

        // Add hover effect to show tech name
        const nameTooltip = document.createElement("div");
        nameTooltip.className = "tech-name-tooltip";
        nameTooltip.textContent = tech.name;
        item.appendChild(nameTooltip);
      });
    } catch (error) {
      console.error("Error initializing TagCloud:", error);
    }
  });

  onBeforeUnmount(() => {
    // Clean up TagCloud instance if it exists and has a destroy method
    if (tagCloudInstance && typeof tagCloudInstance.destroy === "function") {
      tagCloudInstance.destroy();
    }
  });
</script>

<style scoped>
  .tech-sphere {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 80vh;
    width: 100%;
    overflow: hidden;
  }

  .tech-sphere-container {
    perspective: 1000px;
  }

  .tagcloud-container {
    width: 600px;
    height: 600px;
    position: relative;
  }

  /* Global styles for the tag cloud elements */
  :global(.tagcloud) {
    font-family: "Inter", sans-serif;
  }

  :global(.tagcloud--item) {
    padding: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  :global(.tech-icon) {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  :global(.tagcloud--item:hover) {
    transform: scale(1.2) !important;
    filter: drop-shadow(0 0 8px currentColor);
  }

  :global(.tech-name-tooltip) {
    position: absolute;
    background-color: rgba(15, 23, 42, 0.9);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 14px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    transform: translateY(30px);
    z-index: 100;
  }

  :global(.tagcloud--item:hover .tech-name-tooltip) {
    opacity: 1;
  }

  /* Responsive styles */
  @media (max-width: 768px) {
    .tagcloud-container {
      width: 350px;
      height: 350px;
    }
  }
</style>
